"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Influxdb=function(){function t(e,n){return _classCallCheck(this,t),this.sendPointsOnClose=n,this.host=e,this.points=[],this.beaconSent=!1,this.sendPointsOnClose&&this.registerUnloadEvent(),this}return _createClass(t,[{key:"registerUnloadEvent",value:function(){var t=this;window.addEventListener("unload",t.sendBeacon,!1),window.onbeforeunload=function(e){t.sendBeacon()}}},{key:"sendBeacon",value:function(){if(0!=this.points.length&&!this.beaconSent){this.beaconSent=!0;var t=this.implodePoints();navigator.sendBeacon(this.host,t)}}},{key:"point",value:function(t,e,n,i){return this._addPoint(new Influxdb_Point(t,e,n,i))}},{key:"_addPoint",value:function(t){return t.isValid()&&this.points.push(t),this}},{key:"implodePoints",value:function(){if(0==this.points.length)return"";var t,e="",n="";for(t=0;t<this.points.length;++t)this.points[t].isValid()?(n=this.points[t].getLine(),t>0&&e&&(e+="\n"),e+=this.points[t].getLine()):this.points.slice(t,1);return e}},{key:"send",value:function(){if(0==this.points.length)return!1;var t=this.implodePoints();if(t){var e=new XMLHttpRequest;e.open("POST",this.host,!0),e.setRequestHeader("Content-Type","text/plain; charset=UTF-8"),e.send(t)}this.points=[]}}]),t}(),Influxdb_Point=function(){function t(e,n,i,s){_classCallCheck(this,t),this.key=e,"undefined"==typeof n||this.isEmpty(n)||(this.fields=n),"undefined"==typeof i||this.isEmpty(n)||(this.tags=i),"undefined"!=typeof s&&(this.time=s)}return _createClass(t,[{key:"isValid",value:function(){return this.key&&this.fields?!0:!1}},{key:"getLine",value:function(){return this.key||this.fields?(this.line=this.key,this.tags&&(this.line=this.line+","+this.objToString(this.tags)),this.fields&&(this.line=this.line+" "+this.objToString(this.fields)),this.time&&(this.line=this.line+" "+this.time),this.line):void 0}},{key:"sortObjectByKey",value:function(t){if(!Array.prototype.forEach)return t;if(!Array.prototype.sort)return t;if(!Object.keys)return t;var e={};return Object.keys(t).sort().forEach(function(n){e[n]=t[n]}),e}},{key:"objToString",value:function(t){var e,n,i=0,s="";t=this.sortObjectByKey(t);for(var e in t)t.hasOwnProperty(e)&&(e=e.replace(/\s+/g,""),n=t[e].toString(),n=n.replace(/\s+/g,""),i++,i>1&&(s+=","),s+=e+"="+n);return s}},{key:"isEmpty",value:function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return window.JSON?JSON.stringify(t)===JSON.stringify({}):!0}}]),t}();
